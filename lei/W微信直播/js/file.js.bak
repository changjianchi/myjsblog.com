// JavaScript Document
function fileSelect(e) {
	e = e || window.event;
	var files = e.target.files;  //FileList Objects
	var oParent = this.parentElement;
	var ireg = /image\/.*/i,
	var p = oParent.children[3];
	var ul = oParent.children[4];

	for(var i = 0, f; f = files[i]; i++) {
		if(!f.type.match(ireg)) {
			//设置错误信息
			var li = document.createElement('li');
			li.innerHTML = '<li>' + f.name +'不是图片文件.</li>';
			ul.appendChild(li);
			continue;
		}
        var Uid = GetQueryString('uid');
        var token = GetQueryString('token');
        $.ajaxFileUpload({
            type:'get',
            url:'/appapi/?service=User.Upload',
            secureuri:false,
            fileElementId:'fileToUpload',//file标签的id
            dataType: 'json',//返回数据的类型
            data:{
                uid:Uid,
                token:token,
                type:'1'
            },//一同上传的数据
            success: function (data, status) {
                var newData = data;
                if(newData.data.code !== 0){
                    alert(newData.msg);
                }else{
                	var str = '';
	                var str = '<img src="' + newData.data.info + '" class="uploadtu">';
	                $('#upload_card').html(str);
			$('#upload_card').addClass('no-none');
			Ablur(0);
                }
                $('#fileToUpload').replaceWith($('#fileToUpload').clone(true));
                var account = $('#smrz_idcard').get(0);
                var redou = $('#smrz_phone').get(0);
                var smName = $('#smrz_name').get(0);
                var accountNull = null;
                var redouNull = null;
                var nameNull = null;
                var tijiao = $('.tijiao');
                var reg = /^[\u4E00-\u9FA5]+$/;
                var tishiInputSpan = $('.tishi-input span');
                tishiInputSpan.hide();
                function Ablur(a){
                    if(a === 1){
                        if(smName.value != ''){
                            nameNull = 0;
                        }else{
                            nameNull = null;
                        }
                        if(!reg.test(smName.value)){
                            tishiInputSpan.eq(0).show();
                            tijiao.removeClass('active');
                        }else{
                            tishiInputSpan.eq(0).hide();
                        }
                    }else if(a === 2){
                        if(redou.value != ''){
                            redouNull = 0;
                        }else{
                            redouNull = null;
                        }
                        if(redou.value.length != 11){
                            tishiInputSpan.eq(1).show();
                            tijiao.removeClass('active');
                        }else{
                            tishiInputSpan.eq(1).hide();
                        }
                        console.log(redou.length)
                    }else if(a === 3){
                        if(account.value != ''){
                            accountNull = 0;
                        }else{
                            accountNull = null;
                        }
                        if(account.value.length != 18 && account.value.length != 15){
                            tishiInputSpan.eq(2).show();
                            tijiao.removeClass('active');
                        }else{
                            tishiInputSpan.eq(2).hide();
                        }
                    }
                    if($('#upload_card').hasClass('no-none') && $('#upload_hand').hasClass('no-none')){
                      if(account.value.length === 18 || account.value.length === 15 && redou.value.length === 11 && reg.test(smName.value)){
                          tijiaoPD(accountNull,nameNull,redouNull);
                      }
                    }
                }
                function tijiaoPD(a,b,c){
                    if (a != null && b != null && c != null) {
                        tijiao.addClass('active');
                    }else{
                        tijiao.removeClass('active');
                    }
                }
             },
             error:function(data, status, e){
                 $(".tishi").html(e.message);
		 alert('上传失败，图片太大！');
             }
         });

	}
}
//手持照片上传
function fileSelect2(e) {
	e = e || window.event;
	var files = e.target.files;  //FileList Objects
	var oParent = this.parentElement;
	var ireg = /image\/.*/i, p = oParent.children[3];



	var ul = oParent.children[4];

	for(var i = 0, f; f = files[i]; i++) {

		if(!f.type.match(ireg)) {

			//设置错误信息

			var li = document.createElement('li');

			li.innerHTML = '<li>' + f.name +'不是图片文件.</li>';



			ul.appendChild(li);



			continue;

		}



		function GetQueryString(name){

         var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");

         var r = window.location.search.substr(1).match(reg);

         if(r!=null)return  unescape(r[2]); return null;

    	}



		    var Uid = GetQueryString('uid');

        var token = GetQueryString('token');

        $.ajaxFileUpload({

        	type:'post',

            url:'http://www.51rexiu.com/appapi/?service=User.Upload',

            secureuri:false,

            fileElementId:'fileToUpload2',//file标签的id

            dataType: 'json',//返回数据的类型

            data:{

                uid:Uid,

                token:token,

                type:'1'

            },//一同上传的数据

            success: function (data, status) {

                // console.log(data);

                // alert('2');

                var newData = data;



                if(newData.data.code !== 0){

                    alert(newData.msg);

                }else{

                	var str = '';

                	var str = '<img src="' + newData.data.info + '" class="uploadtu">';

	                $('#upload_hand').html(str);
                  $('#upload_hand').addClass('no-none');
                  Ablur(0);

                }

                //$('#upload_card').html(str);

                $('#fileToUpload2').replaceWith($('#fileToUpload2').clone(true));
                var account = $('#smrz_idcard').get(0);
                var redou = $('#smrz_phone').get(0);
                var smName = $('#smrz_name').get(0);

                var accountNull = null;
                var redouNull = null;
                var nameNull = null;

                var tijiao = $('.tijiao');
                var reg = /^[\u4E00-\u9FA5]+$/;

                var tishiInputSpan = $('.tishi-input span');
                tishiInputSpan.hide();

                function Ablur(a){
                    if(a === 1){
                        if(smName.value != ''){
                            nameNull = 0;
                        }else{
                            nameNull = null;
                        }
                        if(!reg.test(smName.value)){
                            tishiInputSpan.eq(0).show();
                            tijiao.removeClass('active');
                        }else{
                            tishiInputSpan.eq(0).hide();
                        }
                    }else if(a === 2){
                        if(redou.value != ''){
                            redouNull = 0;
                        }else{
                            redouNull = null;
                        }
                        if(redou.value.length != 11){
                            tishiInputSpan.eq(1).show();
                            tijiao.removeClass('active');
                        }else{
                            tishiInputSpan.eq(1).hide();
                        }
                        console.log(redou.length)
                    }else if(a === 3){
                        if(account.value != ''){
                            accountNull = 0;
                        }else{
                            accountNull = null;
                        }
                        if(account.value.length != 18 && account.value.length != 15){
                            tishiInputSpan.eq(2).show();
                            tijiao.removeClass('active');
                        }else{
                            tishiInputSpan.eq(2).hide();
                        }
                    }
                    if($('#upload_card').hasClass('no-none') && $('#upload_hand').hasClass('no-none')){
                      if(account.value.length === 18 || account.value.length === 15 && redou.value.length === 11 && reg.test(smName.value)){
                          tijiaoPD(accountNull,nameNull,redouNull);
                      }
                    }
                }

                function tijiaoPD(a,b,c){
                    if (a != null && b != null && c != null) {
                        tijiao.addClass('active');
                    }else{
                        tijiao.removeClass('active');
                    }
                }

             },

             error:function(data, status, e){

                console.log(data);

             }

         });
	}

}

$(function(){
		if(window.File && window.FileList && window.FileReader && window.Blob) {
			$('#fileToUpload').live('change', fileSelect);
			$('#fileToUpload2').live('change', fileSelect2);
		} else {
			document.write('您的浏览器不支持File Api');
		}
		var account = $('#smrz_idcard').get(0);
		var redou = $('#smrz_phone').get(0);
		var smName = $('#smrz_name').get(0);
		var accountNull = null;
		var redouNull = null;
		var nameNull = null;
		var tijiao = $('.tijiao');
		var reg = /^[\u4E00-\u9FA5]+$/;
		var tishiInputSpan = $('.tishi-input span');
		tishiInputSpan.hide();
});
function Ablur(a){
	if(a === 1){
		if(smName.value != ''){
			nameNull = 0;
		}else{
			nameNull = null;
		}
		if(!reg.test(smName.value)){
			tishiInputSpan.eq(0).show();
			tijiao.removeClass('active');
		}else{
			tishiInputSpan.eq(0).hide();
		}
	}else if(a === 2){
		if(redou.value != ''){
			redouNull = 0;
		}else{
			redouNull = null;
		}
		if(redou.value.length != 11){
			tishiInputSpan.eq(1).show();
			tijiao.removeClass('active');
		}else{
			tishiInputSpan.eq(1).hide();
		}
		console.log(redou.length)
	}else if(a === 3){
		if(account.value != ''){
			accountNull = 0;
		}else{
			accountNull = null;
		}
		if(account.value.length != 18 && account.value.length != 15){
			tishiInputSpan.eq(2).show();
			tijiao.removeClass('active');
		}else{
			tishiInputSpan.eq(2).hide();
		}
	}
	if($('#upload_card').hasClass('no-none') && $('#upload_hand').hasClass('no-none')){
		if(account.value.length === 18 || account.value.length === 15 && redou.value.length === 11 && reg.test(smName.value)){
			tijiaoPD(accountNull,nameNull,redouNull);
		}
	}
}

function tijiaoPD(a,b,c){
	if (a != null && b != null && c != null) {
		tijiao.addClass('active');
	}else{
		tijiao.removeClass('active');
	}
}
