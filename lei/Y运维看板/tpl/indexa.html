<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="../css/bootstrap.min.css" type="text/css" rel="stylesheet"/>
    <link href="../css/style.css" type="text/css" rel="stylesheet"/>
    <script src="../js/jquery.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/echarts.min.js"></script>
    <script src="../js/esl.js"></script>
    <title></title>
</head>

<body style="background: #f4fbfc;">
    <div class="wj-wrapper">
        <div class="row" style="margin-left: 0;">
            <div class="col-lg-6 col-md-12 no-left-pd">
                <div class="state-box bd1">
                    <div class="wj-box-tit">系统运行状态</div>
                    <div class="system-state clearfix">
                        <div class="continue-day">
                            <p>系统已连续</p>
                            <p>运营 <span>47</span> 天</p>
                        </div>
                        <div class="system-desc">
                            <div class="state-probar clearfix">
                                <span class="tit">安全运行</span>
                                <span class="num">47</span>
                                <div class="progress">
                                    <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                    </div>
                                </div>
                            </div>
                            <div class="state-probar clearfix">
                                <span class="tit">出现事故</span>
                                <span class="num">3</span>
                                <div class="progress">
                                    <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="3" aria-valuemin="0" aria-valuemax="100" style="width: 3%">
                                    </div>
                                </div>
                            </div>
                            <div class="state-probar clearfix">
                                <span class="tit">出现故障</span>
                                <span class="num">5</span>
                                <div class="progress">
                                    <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="5" aria-valuemin="0" aria-valuemax="100" style="width: 5%">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p class="total-gd-num">2016年累计受理工单总数 <i>296</i></p>
                </div>
            </div>
            <div class="col-lg-6 col-md-12 no-left-pd">
                <div class="state-box bd1">
                    <div class="wj-box-tit">系统可用性</div>
                    <div class="wj-usealbe-box">
                        <div class="col-xs-4 fansize">
                            <div id="xiaoque" class="fanbox"></div>
                        </div>
                        <div class="col-xs-4 fansize">
                            <div id="keyongxing" class="fanbox"></div>
                        </div>
                        <div class="col-xs-4 fansize">
                            <div id="manyidu" class="fanbox"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row wj-trend-chart">
            <div class="col-lg-12">
                <div class="wj-box-tit">近一年运维工单趋势</div>
                <div class="wj-trend-box">
                    <div class="draw-trend-chart" id="trendChart"></div>
                </div>
            </div>
        </div>
        <div class="row wj-gd-rate" style="margin-left: 0;">
            <div class="col-lg-6 col-md-12 no-left-pd">
                <div class="wj-box-tit">工单来源占比</div>
                <div class="wj-gd-box" >
                    <div class="draw-gd-box" id="gdSource"></div>
                </div>
            </div>
            <div class="col-lg-6 col-md-12 no-left-pd">
                <div class="wj-box-tit">工单类型占比</div>
                <div class="wj-gd-box">
                    <div class="draw-gd-box" id="gdType"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        //运维趋势  trendData 是月份对应的数据 - 表示空
        var trendData= [115, 10, 128, 115, 5, 135, 178, '-', '-', '-', '-','-'];

        //工单来源  gdNameValue是要传的数据
        var gdNameValue=[
            {value:1, name:'网站'},
            {value:1, name:'风控'},
            {value:6, name:'PMIS'},
            {value:1, name:'SAP'}
        ];

        //工单类型占比   typeNameValue是要传的数据
        var typeNameValue=[
            {value:6, name:'管理类'},
            {value:7, name:'权限类'},
            {value:137, name:'操作类'},
            {value:4, name:'主数据类'},
            {value:3, name:'配置类'}
        ];

        //系统可用性 依次传入三个参数
        var usePara=[
           {
             name:'消缺率',
             rate:0.4
           },
            {
                name:'系统可用性',
                rate:0.3
            },
            {
                name:'客户满意度',
                rate:0.8
            }
        ];

        require.config({
            packages: [
                {
                    name: 'zrender',
                    location: '../js/zrender',
                    main: 'zrender'
                }
            ]
        });

        require(["zrender"], function(zrender){
            // 初始化zrender
            var zr1 = zrender.init(document.getElementById("xiaoque"));
            drawPic(zr1,usePara[0]);

            var zr2 = zrender.init(document.getElementById("keyongxing"));
            drawPic(zr2,usePara[1]);

            var zr3 = zrender.init(document.getElementById("manyidu"));
            drawPic(zr3,usePara[2]);
        });

        function drawPic(zr1,obj){
            var usebleRate1=obj.rate;

            var cavWidth=zr1.getWidth(),cavHeight=zr1.getHeight();

            //扇形圆心坐标
            var x0=Math.ceil(cavWidth/2),y0=152,r0=115;
            //中心角度
            var centerAngle=150-Math.floor(120*usebleRate1);
            var rateNum=usebleRate1*100,rateTxt='%';
            if(rateNum ==Math.abs(rateNum)){
                rateTxt=rateNum+rateTxt;
            }else{
                rateTxt=rateNum.toFixed(2)+rateTxt;
            }

            zr1.addShape({
                shape : 'sector',
                hoverable:false,
                style : {
                    x : x0,
                    y : y0,
                    r : r0,
                    r0 : 40,
                    startAngle : centerAngle,
                    endAngle : 160,
                    color : 'rgb(11, 211, 245)',
                    text:rateTxt,
                    textFont:'16px "Microsoft Yahei"',
                    textPosition:'inside'
                }
            });
            zr1.addShape({
                shape : 'sector',
                hoverable:false,
                style : {
                    x : x0,
                    y : y0,
                    r : r0,
                    r0 : 40,
                    startAngle : 30,
                    endAngle : centerAngle,
                    color : 'rgb(243, 243, 243)',
                }
            });
            //指针中心点Y坐标 针长 及针点半径
            var pinY=138,pinL=140,pinR=8;
            var x1=x0+r0*Math.cos(centerAngle *Math.PI/180),
                    y1=y0-r0*Math.sin(centerAngle*Math.PI/180);
            var theR=Math.sqrt((pinY-y1)*(pinY-y1)+(x1-x0)*(x1-x0));
            var sinTheta2=(pinY-y1)/theR,
                    cosTheta2=(x1-x0)/theR;
            var x2=pinL*cosTheta2+x0,
                    y2=pinY-pinL*sinTheta2;
            var x3=pinR*sinTheta2+x0,
                    y3=pinR*cosTheta2+pinY;
            var x4=x0-pinR*sinTheta2,
                    y4=pinY-pinR*cosTheta2;
            //画圆
            zr1.addShape({
                shape : 'circle',
                hoverable:false,
                style : {
                    x : x0,
                    y : pinY,
                    r : pinR,
                    color : 'rgb(236, 73, 76)'
                }
            });
            //画线
            zr1.addShape({
                shape : 'polygon',
                hoverable:false,
                style : {
                    pointList : [[x2, y2], [x3, y3], [x4, y4]],
                    color : 'rgb(236, 73, 76)'
                }
            });
            //文字
            zr1.addShape({
                shape : 'text',
                hoverable:false,
                style : {
                    x : x0-(obj.name).length * 8,
                    y : 175,
                    color : 'rgb(53,53,53)',
                    lineWidth : 8,
                    text : obj.name,
                    textFont : '18px "Microsoft Yahei"'
                }
            });

            zr1.render();
        }

    </script>

    <script src="../js/common.js"></script>
</body>
</html>